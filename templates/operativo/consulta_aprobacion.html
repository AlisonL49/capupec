{% extends "navbar.html" %}
{% load static %}
{% block content %}

<style>
    /* Pestaña activa: azul y negrita */
    .nav-tabs .nav-link.active {
        color: #6c757d !important;
        /* Azul Bootstrap */
        font-weight: bold;
    }

    /* Pestaña inactiva: gris claro */
    .nav-tabs .nav-link {
        color: #adb5bd !important;
        /* Gris claro */
        font-weight: normal;
    }

    /* Al pasar el mouse sobre las inactivas */
    .nav-tabs .nav-link:hover {
        color: #6c757d !important;
        /* Gris medio */
    }
</style>

<div class="container mt-4">
    <div class="card ">
        <div class="card-custom-header  d-flex">
            <h5 class="mb-0">Consultas de Solicitudes y Créditos </h5>
        </div>
        <div class="card-body">

            <!-- Pestañas -->
            <ul class="nav nav-tabs" id="creditoTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="solicitudes-tab" data-bs-toggle="tab"
                        data-bs-target="#solicitudes" type="button" role="tab">
                        Solicitudes
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="aprobados-tab" data-bs-toggle="tab" data-bs-target="#aprobados"
                        type="button" role="tab">
                        Créditos Aprobados
                    </button>
                </li>
            </ul>

            <div class="tab-content mt-3" id="creditoTabsContent">

                <!-- TAB Solicitudes -->
                <div class="tab-pane fade show active" id="solicitudes" role="tabpanel">

                    <!-- Buscador -->
                    <form method="get" class="d-flex mb-3">
                        <input type="text" name="q" class="form-control me-2" placeholder="Buscar por cédula..."
                            value="{{ request.GET.q }}">
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-search"></i> Buscar
                        </button>
                    </form>

                    <!-- Tabla -->
                    <div class="table-responsive">
                        <table
                            class="table table-bordered table-hover rounded table-striped align-middle text-center overflow-hidden ">
                            <thead class="table-secondary">
                                <tr>
                                    <th>No. Solicitud</th>
                                    <th>Fecha</th>
                                    <th>Cédula</th>
                                    <th>Nombre completo</th>
                                    <th>Monto solicitado</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for solicitud in page_obj %}
                                <tr>
                                    <td>{{ solicitud.sol_nro_solicitud }}</td>
                                    <td>{{ solicitud.sol_fecha_solicitud }}</td>
                                    <td>{{ solicitud.sol_socio.user.username }}</td>
                                    <td>{{ solicitud.sol_socio.user.first_name }} {{ solicitud.sol_socio.user.last_name }}</td>
                                    <td>${{ solicitud.sol_monto|floatformat:2 }}</td>
                                    <td>
                                        <span class="badge 
                                            {% if solicitud.sol_estado.estado_nombre == 'Pendiente' %} bg-warning bg-opacity-50 text-dark
                                            {% elif solicitud.sol_estado.estado_nombre == 'Aprobado' %} bg-success bg-opacity-75
                                            {% elif solicitud.sol_estado.estado_nombre == 'Preaprobado' %} bg-primary bg-opacity-50 text-dark
                                            {% elif solicitud.sol_estado.estado_nombre == 'Rechazado' %} bg-danger bg-opacity-75
                                            {% else %} bg-secondary {% endif %}">
                                            {{ solicitud.sol_estado.estado_nombre }}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary"
                                            onclick="verDetalleSolicitud({{ solicitud.id }})" title="Ver Detalles">
                                            <i class="fas fa-info"></i>
                                        </button>

                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No se encontraron solicitudes</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                        <!-- Controles de paginación -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ search_query }}">Anterior</a>
                                </li>
                                {% else %}
                                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                {% if page_obj.number == num %}
                                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                {% else %}
                                    <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}&q={{ search_query }}">{{ num }}</a>
                                    </li>
                                {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ search_query }}">Siguiente</a>
                                </li>
                                {% else %}
                                <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>

                <!-- TAB Créditos Aprobados -->
                <div class="tab-pane fade" id="aprobados" role="tabpanel">
                    <p class="text-muted">Aquí se mostrarán los créditos aprobados...</p>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Modal vacío -->
<div class="modal fade" id="detalleSolicitudModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="detalleSolicitudContent">
            <!-- Aquí se carga el detalle por AJAX -->
        </div>
    </div>
</div>
<!-- Modal Detalle Solicitud -->
<div class="modal fade" id="detalleSolicitudModal" tabindex="-1" aria-labelledby="detalleSolicitudModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" id="detalleSolicitudContent">
      <!-- Aquí se cargará el detalle_solicitud.html vía fetch -->
    </div>
  </div>
</div>

<!-- Archivo de scripts global -->
<script src="{% static 'js/scripts.js' %}"></script>


<!--<script>
function verDetalleSolicitud(id) {
  fetch(`/operativo/consulta/${id}/detalle/`)
    .then(response => response.text())
    .then(html => {
      document.getElementById("detalleSolicitudContent").innerHTML = html;
      new bootstrap.Modal(document.getElementById("detalleSolicitudModal")).show();
    });
}

function actualizarEstado(id, accion) {
  fetch(`/consulta/${id}/${accion}/`)
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert("Solicitud " + data.estado);
        location.reload();
      } else {
        alert("Error: " + data.error);
      }
    });
}
</script>-->


{% endblock %}